<form name="formulario" role="form" id="formulario" method="post" action="RestMod/guardar"
data-fv-excluded="disabled"
data-fv-icon-valid="glyphicon glyphicon-ok"
data-fv-icon-invalid="glyphicon glyphicon-remove"
data-fv-icon-validating="glyphicon glyphicon-refresh">                       

<div class="modal fade" id="modalAdicionar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Nueva Modelo</h4>
      </div>
      <div class="modal-body">
        <!-- Text input-->
        
        <div class="form-group">
         <label>Marca</label>
         <select class="form-control selectpicker" id="marcas" name="idmarc" required="required" data-live-search="true">

         </select>

       </div>
       <div class="form-group">
         <label>Nombre</label> <input id="nomModelo" name="nombre" type="text" autocomplete="off"
         placeholder="ingrese Modelo" class="form-control input-md"
         data-fv-notempty="true" >
       </div>
       <div class="form-group">
         <label>A&#241;o</label>
         <select class="form-control selectpicker" id="anhoss" name="anho" required="required" data-live-search="true">

         </select>

       </div>
       <div class="modal-footer">
        <button type="submit" id="btnAdicionarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
      </div>
    </div>
  </div>

</div>
</div>
</form>
<form name="formularioModificar" role="form" id="formularioModificar" method="post" action="RestMod/actualizar"
data-fv-excluded="disabled"
data-fv-icon-valid="glyphicon glyphicon-ok"
data-fv-icon-invalid="glyphicon glyphicon-remove"
data-fv-icon-validating="glyphicon glyphicon-refresh">
<div class="modal fade" id="modalModificar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog"role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Modificar Modelo</h4>
      </div>
      <div class="modal-body">
        <input type="hidden" name="idmod" id="idmod1" />
        <!-- Text input-->
        
        <div class="form-group">
         <label>Marca</label>
         <select class="form-control selectpicker" id="marcas1" name="idmarc" required="required" data-live-search="true">

         </select>

       </div>


       <div class="form-group">
         <label>Nombre</label> <input id="nommarc1" name="nombre" type="text"
         placeholder="ingrese categoria" class="form-control input-md"
         data-fv-notempty="true">
       </div>

       <div class="form-group">
         <label>A&#241;o</label>
         <select class="form-control selectpicker" id="anhos1" name="anho" required="required" data-live-search="true">

         </select>

       </div>
     </div>
     <div class="modal-footer">
      <button type="submit" id="btnModificarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
      <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
    </div>
  </div>
</div>

</div>
</form>
<div class="modal fade" id="modalEliminar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <form name="formularioEliminar" role="form" id="formularioEliminar" method="post" action="RestMod/eliminar"
  data-fv-excluded="disabled"
  data-fv-icon-valid="glyphicon glyphicon-ok"
  data-fv-icon-invalid="glyphicon glyphicon-remove"
  data-fv-icon-validating="glyphicon glyphicon-refresh">
  <div class="modal-dialog " style="width: 40%" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Eliminar Modelo</h4>
      </div>
      <div class="modal-body">
        <input type="hidden" id="idmod2" name="idmod" />  
        <div class="row">
         <div class="col-md-9"><h3>Â¿Esta seguro de Eliminar? <b id="tipoLabel"></b></h3></div>
       </div>   
     </div>
     <div class="modal-footer">
      <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
      <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
    </div>
  </div>
</div>
</form>
</div>

<div class="row">
  <div class="col-lg-12">
   <div class="panel panel-default">

    <div class="panel-body">
     <div class="dataTable_wrapper">
      <table id="example" class="w3-table-all w3-tiny w3-table-hoverable w3-card-4" style="width: 100% !important">
        <thead>
          <tr>
           <th>Nombre</th>
           <th>A&#241;o</th>
           <th>Marca</th>
           <th width="200px"></th>
         </tr>
       </thead>
       <tbody >

       </tbody>
     </table>  
   </div>
 </div>
</div>
</div>
</div> 
<script type="text/javascript">


  $(document).ready(function() {
   var btnGroup='';
   $('#example').dataTable( {
    "oLanguage": {
      "sUrl": "js/Spanish.lang"
    },
    responsive:true,
    "processing": true,
    "dom":"<'row w3-tiny'<'col-sm-8'<'#tableTitle'>><'col-sm-1'<'#tableHeader'>><'col-sm-3'f>><'row'<'col-sm-12'tr>><'row w3-tiny'<'col-sm-5'i><'col-sm-7'p>>",
    "serverSide": true,
    "ajax": {
     "type": "POST",
     "url": "RestMod/lista",
     "data": function ( d ) {
       d.estado = 1;
     }
   },
   "columns": [
   { "data": "nombre" },
   { "data": "anho" },
   { "data": "idmarc"},
   { "data": "idmod"}
   ],
   "createdRow": function ( row, data, index ){
     if(data.estado==1){
       btnGroup='';
       btnGroup+='<button class="btn btn-xs btn-primary modificar"  data-toggle="tooltip" data-placement="top" title="Modificar" data-id="'+data.idmod+'"><i class="fa fa-edit"></i> | modificar</button>';
       btnGroup+='<button class="btn btn-xs btn-danger eliminar"  data-toggle="tooltip" data-placement="top" title="Eliminar" data-id="'+data.idmod+'"><i class="glyphicon glyphicon-remove-sign"></i> | eliminar</button>';
       $.post('RestMarc/obtener?id='+data.idmarc, function(result){
         $('td', row).eq(2).html(result.data.nombre);
       })
       $('td', row).eq(3).html('<div class="btn-group">'+btnGroup+'</div>');

     }
   },
   "drawCallback": function( settings ) { 
    $('#tableTitle').html('<h6><b>Modelos</b></h6>');
    $('#tableHeader').html('<button class="btn btn-xs btn-primary" id="btnAdicionar"><i class="fa fa-plus-circle"></i> | adicionar</button>');
    $('#btnAdicionar').click(function(){
      $('#formulario').data('formValidation').resetForm();
      $('#formulario')[0].reset();
      
      var cad=" "
      var ano = (new Date).getFullYear();
      for(var i=0;i<30;i++){
        cad=cad+'<option value='+ano+'>'+ano+'</option>';
        ano=ano-1;
      }
      $('#anhoss').html(cad);
      $('#anhoss').selectpicker();
      $('#anhoss').selectpicker('refresh'); 
      $.post('RestMarc/listar', function(result) {//$(this).data('id') es el atributo del boton data-id; q
        if(result.status){
         var cad="";
         for(var i=0;i<result.data.length;i++){
          cad=cad+'<option value='+result.data[i].idmarc+'>'+result.data[i].nombre+'</option>';
        }
        $('#marcas').html(cad);
        $('#marcas').selectpicker();
        $('#marcas').selectpicker('refresh');     //$('#formularioModificar').loadJSON(result.data);
      }
      
    }, 'json');
      $('#modalAdicionar').modal('show');
    });
    $('.modificar').click(function(){ 
     $('#formularioModificar').data('formValidation').resetForm();
     $('#formularioModificar')[0].reset();
     console.log("aqui")
      $.post('RestMod/obtener?id='+$(this).data('id'), function(result) {//$(this).data('id') es el atributo del boton data-id; q tiene 
        var ianho=result.data.anho;
        var imarc=result.data.idmarc;
        console.log("Modelo "+result)
        console.log(result.status)
        console.log(ianho)
        if(result.status){
         console.log(imarc)
         $('#modalModificar').modal('show');
         $('#formularioModificar').loadJSON(result.data);
            $.post('RestMarc/listar', function(result1) {//$(this).data('id') es el atributo del boton data-id; q
              if(result1.status){
               var cad="";
               for(var i=0;i<result1.data.length;i++){
                  cad=cad+'<option value="'+result1.data[i].idmarc+'">'+result1.data[i].nombre+'</option>';
                
               }
              $('#marcas1').html(cad);
              $('#marcas1').selectpicker();
              $("#marcas1").val(imarc);
              $('#marcas1').selectpicker('refresh');//$('#formularioModificar').loadJSON(result.data);
             }
           })
            var cad=" "
            var ano = (new Date).getFullYear();
            for(var i=0;i<30;i++){
              cad=cad+'<option value="'+ano+'">'+ano+'</option>';
              ano=ano-1;
            }
            $('#anhos1').html(cad);
            $('#anhos1').selectpicker();
            $('#anhos1').val(ianho);
            $('#anhos1').selectpicker('refresh');
          }
        });
    });
    $('.eliminar').click(function(){ 
     $('#formularioEliminar').data('formValidation').resetForm();
     $('#formularioEliminar')[0].reset();
     $.post('RestMod/obtener?id='+$(this).data('id'), function(result) {
       if(result.status){
        $('#modalEliminar').modal('show');
        $('#formularioEliminar').loadJSON(result.data);
        $('#tipoLabel').html(result.data.nombre);
      }
    }, 'json');
   });

    $('button[data-toggle="tooltip"]').tooltip({animated: 'fade',placement: 'bottom',});

  }
} );

$('.estado').click(function(){
 $('#example').dataTable().fnDraw('page');
});

$('#formulario,#formularioModificar,#formularioEliminar').formValidation(
  {locale: 'es_ES'}).on('success.form.fv', function(e) {
                            e.preventDefault();// para dejar la pantalla en la posicion que se encuentra 
                            var $form = $(e.target);
                            $.post($form.attr('action'), $form.serialize(), function(result) {
                              if(result.status){
                               $form.data('formValidation').resetForm();
                               $('#formulario')[0].reset();
                               $('#formularioModificar')[0].reset();
                               $('#formularioEliminar')[0].reset();
                               $('#example').dataTable().fnDraw('page');
                              //  mostrarMensaje('info','Se realizo con exito la Transaccion');

                            }
                            $('.modal').modal('hide');
                          }, 'json');
                          });
});
</script>