<form name="formulario" role="form" id="formulario" method="post" action="RestItem/guardar"
data-fv-excluded="disabled"
data-fv-icon-valid="glyphicon glyphicon-ok"
data-fv-icon-invalid="glyphicon glyphicon-remove"
data-fv-icon-validating="glyphicon glyphicon-refresh">                       

<div class="modal fade" id="modalAdicionar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Nuevo Item</h4>
      </div>
      <div class="modal-body">
        <!-- Text input-->
        
        <div class="form-group">
         <label>Marca</label>
         <select class="form-control" id="idmarcas" name="idmarc" required="required">

         </select>
         
       </div>

       <div class="form-group">
         <label>Modelo</label>
         <select class="form-control" id="idmod" name="idmod" required="required">

         </select>
         
       </div>

       <div class="form-group">
         <label>Color</label>
         <select class="form-control" id="idcolor" name="idcolor" required="required">

         </select>
         
       </div>

       <div class="form-group">
         <label>Linea</label>
         <select class="form-control" id="idlinea" name="idlinea" required="required">

         </select>
         
       </div>

     </div>
     <div class="modal-footer">
      <button type="submit" id="btnAdicionarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
      <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
    </div>
  </div>
</div>

</div>
</form>
<form name="formularioModificar" role="form" id="formularioModificar" method="post" action="RestItem/actualizar"
data-fv-excluded="disabled"
data-fv-icon-valid="glyphicon glyphicon-ok"
data-fv-icon-invalid="glyphicon glyphicon-remove"
data-fv-icon-validating="glyphicon glyphicon-refresh">
<div class="modal fade" id="modalModificar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog"role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Modificar Item</h4>
      </div>
      <div class="modal-body">
        <input type="hidden" name="iditem" id="iditem1" />
        <!-- Text input-->
       <div class="form-group">
         <label>Marca</label>
         <select class="form-control" id="idmarcas1" name="idmarc" required="required">

         </select>
         
       </div>

       <div class="form-group">
         <label>Modelo</label>
         <select class="form-control" id="idmod1" name="idmod" required="required">

         </select>
         
       </div>

       <div class="form-group">
         <label>Color</label>
         <select class="form-control" id="idcolor1" name="idcolor" required="required">

         </select>
         
       </div>

       <div class="form-group">
         <label>Linea</label>
         <select class="form-control" id="idlinea1" name="idlinea" required="required">

         </select>
         
       </div>
     </div>
     <div class="modal-footer">
      <button type="submit" id="btnModificarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
      <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
    </div>
  </div>
</div>

</div>
</form>
<div class="modal fade" id="modalEliminar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <form name="formularioEliminar" role="form" id="formularioEliminar" method="post" action="RestItem/eliminar"
  data-fv-excluded="disabled"
  data-fv-icon-valid="glyphicon glyphicon-ok"
  data-fv-icon-invalid="glyphicon glyphicon-remove"
  data-fv-icon-validating="glyphicon glyphicon-refresh">
  <div class="modal-dialog " style="width: 40%" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Eliminar Item</h4>
      </div>
      <div class="modal-body">
        <input type="hidden" id="iditem2" name="iditem" />	
        <div class="row">
         <div class="col-md-9"><h3>Â¿Esta seguro de Eliminar? <b id="tipoLabel"></b></h3></div>
       </div>		
     </div>
     <div class="modal-footer">
      <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
      <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
    </div>
  </div>
</div>
</form>
</div>

<div class="row">
  <div class="col-lg-12">
   <div class="panel panel-default">

    <div class="panel-body">
     <div class="dataTable_wrapper">
      <table id="example" class="w3-table-all w3-tiny w3-table-hoverable w3-card-4" style="width: 100% !important">
        <thead>
          <tr>
           <th>Marca</th>
           <th>Modelo</th>
           <th>Color</th>
           <th>linea</th>
           <th width="200px"></th>
         </tr>
       </thead>
       <tbody >

       </tbody>
     </table>  
   </div>
 </div>
</div>
</div>
</div> 
<script type="text/javascript">
  $(document).ready(function() {
   var btnGroup='';
   $('#example').dataTable( {
    "oLanguage": {
      "sUrl": "js/Spanish.lang"
    },
    responsive:true,
    "processing": true,
    "dom":"<'row w3-tiny'<'col-sm-8'<'#tableTitle'>><'col-sm-1'<'#tableHeader'>><'col-sm-3'f>><'row'<'col-sm-12'tr>><'row w3-tiny'<'col-sm-5'i><'col-sm-7'p>>",
    "serverSide": true,
    "ajax": {
     "type": "POST",
     "url": "RestItem/lista",
     "data": function ( d ) {
       d.disponible = 1;
     }
   },
   "columns": [
   { "data": "idmod" },
   { "data": "idmod" },
   {"data":"idcolor"},
   {"data":"idlinea"},
   {"data": "iditem"}
   ],
   "createdRow": function ( row, data, index ){
     if(data.disponible==1){
       btnGroup='';
       btnGroup+='<button class="btn btn-xs btn-primary modificar"  data-toggle="tooltip" data-placement="top" title="Modificar" data-id="'+data.iditem+'"><i class="fa fa-edit"></i> | modificar</button>';
       btnGroup+='<button class="btn btn-xs btn-danger eliminar"  data-toggle="tooltip" data-placement="top" title="Eliminar" data-id="'+data.iditem+'"><i class="glyphicon glyphicon-remove-sign"></i> | eliminar</button>';
       $('td', row).eq(4).html('<div class="btn-group">'+btnGroup+'</div>');
       $.post('RestMarc/obtenerporidmodelo?id='+data.idmod, function(result){
         $('td', row).eq(0).html(result.data.nombre);
       })
       $.post('RestMod/obtener?id='+data.idmod, function(result){
         $('td', row).eq(1).html(result.data.nombre+"-"+result.data.anho);
       })
       $.post('Restcol/obtener?id='+data.idcolor, function(result){
         $('td', row).eq(2).html(result.data.nombre);
       })
       $.post('RestLinea/obtener?id='+data.idlinea, function(result){
         $('td', row).eq(3).html(result.data.nombre);
       })
     }
   },
   "drawCallback": function( settings ) {	
    $('#tableTitle').html('<h6><b>Items</b></h6>');
    $('#tableHeader').html('<button class="btn btn-xs btn-primary" id="btnAdicionar"><i class="fa fa-plus-circle"></i> | adicionar</button>');
    $('#btnAdicionar').click(function(){
      $('#formulario').data('formValidation').resetForm();
      $('#formulario')[0].reset();
      $.post('RestMarc/listar', function(result) {
        $('#modalAdicionar').modal('show');
        if(result.status){
         var cad="";
         for(var i=0;i<result.data.length;i++){
          cad=cad+'<option value="'+result.data[i].idmarc+'">'+result.data[i].nombre+'</option>';
         }
         $('#idmarcas').html(cad);
         $('#idmarcas').selectpicker();     //
        }
      
      }, 'json');
      $.post('Restcol/listar', function(result) {
        $('#modalAdicionar').modal('show');
        if(result.status){
         var cad="";
         for(var i=0;i<result.data.length;i++){
          cad=cad+'<option value="'+result.data[i].idcolor+'">'+result.data[i].nombre+'</option>';
         }
         $('#idcolor').html(cad);
         $('#idcolor').selectpicker();     //
        }
      
      }, 'json');

      $.post('RestLinea/listar', function(result) {
        $('#modalAdicionar').modal('show');
        if(result.status){
         var cad="";
         for(var i=0;i<result.data.length;i++){
          cad=cad+'<option value="'+result.data[i].idlinea+'">'+result.data[i].nombre+'</option>';
         }
         $('#idlinea').html(cad);
         $('#idlinea').selectpicker();     //
        }
      
      }, 'json');

    })

    $('#idmarcas1').change(function(){
      $.post('RestMod/listaridmarc?idmarc='+$( '#idmarcas1 option:selected').val(), function(result) {//$(this).data('id') es el atributo del boton data-id; q
        console.log("aqui"+result)
        if(result.status){
         var cad="";
         for(var i=0;i<result.data.length;i++){
          cad=cad+'<option value="'+result.data[i].idmod+'">'+result.data[i].nombre+"-"+result.data[i].anho+'</option>';
        }
        console.log(cad)
        $('#idmod1').html(cad);
        $('#idmod1').selectpicker();
        $('#idmod1').selectpicker('refresh');
           //$('#formularioModificar').loadJSON(result.data);
         }
       }, 'json');
    })

    $('#idmarcas').change(function(){
      $.post('RestMod/listaridmarc?idmarc='+$( '#idmarcas option:selected').val(), function(result) {//$(this).data('id') es el atributo del boton data-id; q
        console.log("aqui"+result)
        if(result.status){
         var cad="";
         for(var i=0;i<result.data.length;i++){
          cad=cad+'<option value="'+result.data[i].idmod+'">'+result.data[i].nombre+"-"+result.data[i].anho+'</option>';
        }
        console.log(cad)
        $('#idmod').html(cad);
        $('#idmod').selectpicker();
        $('#idmod').selectpicker('refresh');
           //$('#formularioModificar').loadJSON(result.data);
         }
       }, 'json');
    })


    $('.modificar').click(function(){ 
     $('#formularioModificar').data('formValidation').resetForm();
     $('#formularioModificar')[0].reset();
      $.post('RestItem/obtener?id='+$(this).data('id'), function(result) {//$(this).data('id') es el atributo del boton data-id; q tien
        if(result.status){
         $('#modalModificar').modal('show');
         $('#formularioModificar').loadJSON(result.data);
         

        $.post('RestMarc/listar', function(result1) {
        
          if(result1.status){
            
            $.post('RestMarc/obtenerporidmodelo?id='+result.data.idmod, function(result2){
              
              var cad="";
              for(var i=0;i<result1.data.length;i++){
                cad=cad+'<option value="'+result1.data[i].idmarc+'">'+result1.data[i].nombre+'</option>';
              }
              $('#idmarcas1').html(cad);
              $('#idmarcas1').selectpicker();
              $('#idmarcas1').val(result2.data.idmarc);
              $('#idmarcas1').selectpicker('refresh');
                   //
            })
          }
      
      }, 'json');

      $.post('RestMod/listar', function(result1) {
        if(result1.status){
         var cad="";
         for(var i=0;i<result1.data.length;i++){
          cad=cad+'<option value="'+result1.data[i].idmod+'">'+result1.data[i].nombre+"-"+result1.data[i].anho+'</option>';
         }
         $('#idmod1').html(cad);
         $('#idmod1').selectpicker();     //
         $('#idmod1').val(result.data.idmod);
         $('#idmod1').selectpicker('refresh');
        }
      
      }, 'json');

      $.post('Restcol/listar', function(result1) {
        if(result1.status){
         var cad="";
         for(var i=0;i<result1.data.length;i++){
          cad=cad+'<option value="'+result1.data[i].idcolor+'">'+result1.data[i].nombre+'</option>';
         }
         $('#idcolor1').html(cad);
         $('#idcolor1').selectpicker();     //
         $('#idcolor1').val(result.data.idcolor);
         $('#idcolor1').selectpicker('refresh');
        }
      
      }, 'json');

      $.post('RestLinea/listar', function(result1) {
        
        if(result1.status){
         var cad="";
         for(var i=0;i<result1.data.length;i++){
          cad=cad+'<option value="'+result1.data[i].idlinea+'">'+result1.data[i].nombre+'</option>';
         }
         $('#idlinea1').html(cad);
         $('#idlinea1').selectpicker();     //
         $('#idlinea1').val(result.data.idlinea)
         $('#idlinea1').selectpicker('refresh');
        }
      
      }, 'json');


       }
     });


    }) 
    $('.eliminar').click(function(){ 
     $('#formularioEliminar').data('formValidation').resetForm();
     $('#formularioEliminar')[0].reset();
     $.post('RestItem/obtener?id='+$(this).data('id'), function(result) {
       if(result.status){
        $('#modalEliminar').modal('show');
        
        $('#formularioEliminar').loadJSON(result.data);
          $.post('RestMod/obtener?id='+result.data.idmod, function(result1){
          $('#tipoLabel').html(result1.data.nombre+"-"+result1.data.anho);
          })
        }
      }, 'json');
   });

    $('button[data-toggle="tooltip"]').tooltip({animated: 'fade',placement: 'bottom',});

  }
} );

$('.estado').click(function(){
 $('#example').dataTable().fnDraw('page');
});

$('#formulario,#formularioModificar,#formularioEliminar').formValidation(
  {locale: 'es_ES'}).on('success.form.fv', function(e) {
                            e.preventDefault();// para dejar la pantalla en la posicion que se encuentra 
                            var $form = $(e.target);
                            $.post($form.attr('action'), $form.serialize(), function(result) {
                            	if(result.status){
                               $form.data('formValidation').resetForm();
                               $('#formulario')[0].reset();
                               $('#formularioModificar')[0].reset();
                               $('#formularioEliminar')[0].reset();
                               $('#example').dataTable().fnDraw('page');
                    	        //	mostrarMensaje('info','Se realizo con exito la Transaccion');

                           }
                           $('.modal').modal('hide');
                         }, 'json');
                          });
});
</script>
