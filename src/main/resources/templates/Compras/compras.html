  <form name="formulario" role="form" id="formularioDcompra" method="post" action="RestComp/detalle"
  data-fv-excluded="disabled"
  data-fv-icon-valid="glyphicon glyphicon-ok"
  data-fv-icon-invalid="glyphicon glyphicon-remove"
  data-fv-icon-validating="glyphicon glyphicon-refresh"> 
  <div class="modal fade" id="modalDetalle" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Detalle compra</h4>
        </div>
        <div class="modal-body">

          <div class="form-group">
           <label>Nº Compra</label> <input id="num_compra" name="num_compra" type="text" disabled
           class="form-control input-md"
           data-fv-notempty="true">
         </div>

         <div class="form-group">
           <label>Fecha Compra</label> <input id="fcompra" name="fecha_importacion" type="text" disabled
           class="form-control input-md"
           data-fv-notempty="true">
         </div>       

         <div class="form-group">
           <label>Nº Embarque</label> <input id="Embarque" name="num_embarque" type="text" disabled
           class="form-control input-md"
           data-fv-notempty="true">
         </div>

         <div class="form-group">
          <div class="row">
            <div class="col-lg-12">
             <div class="panel panel-default">

              <div class="panel-body">
               <div class="dataTable_wrapper">
                <table id="example2" class="w3-table-all w3-tiny w3-table-hoverable w3-card-4" style="width: 100% !important">
                  <thead>
                    <tr>
                     <th>Marca</th>
                     <th>Modelo</th>
                     <th>Color</th>
                     <th>Chasis</th>
                     <th>Motor</th>
                     <th>Precio</th>
                   </tr>
                 </thead>
                 <tbody id="cuerpotabla">

                 </tbody>
               </table>  
             </div>
           </div>
         </div>
       </div>
     </div>
   </div>
 </div>
 <div class="modal-footer">
  <button type="button" class="btn btn-primary" data-dismiss="modal"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
</div>
</div>
</div>

</div>
</form>


<form name="formularioagregar" role="form" id="formularioagregar" method="post" action="RestComp/guardar"
data-fv-excluded="disabled"
data-fv-icon-valid="glyphicon glyphicon-ok"
data-fv-icon-invalid="glyphicon glyphicon-remove"
data-fv-icon-validating="glyphicon glyphicon-refresh">                       

<div class="modal fade" id="modalAdicionar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Nueva Compra</h4>
      </div>
      <div class="modal-body">
        <!-- Text input-->

        <div class="form-group">
         <label>Fecha compra</label> <input id="fcompra2" name="fecha_importacion" type="date"  max="2030-01-01" autocomplete="off"
         placeholder="ingrese fecha" class="form-control input-md"
         data-fv-notempty="true" >
       </div>

       <div class="form-group">
         <label>Nº de Embarque</label> <input id="Nembarque" name="num_embarque" type="text" autocomplete="off"
         placeholder="ingrese Nº de embarque" class="form-control input-md"
         data-fv-notempty="true" >
       </div>

       <div class="form-group">
         <label>Nº de Importaci&#243;n</label> <input id="Nimportacion" name="num_importacion" type="text" autocomplete="off"
         placeholder="ingrese Nº de importacion" class="form-control input-md"
         data-fv-notempty="true" >
       </div>

       <div class="form-group">
         <label>Pais</label>
         <select class="form-control  selectpicker" id="pais1" name="idpais" required="required" data-live-search="true">

         </select>

       </div>

       </form>
        <div class="form-group">
         <div class="container">
          <div class="row">
              <div class="col-md-2">
                <label >Agregar items</label><br>
                <button type="button" class="btn btn-primary" id="agregarC">Agregar</button>
              </div>
              <div class="col-md-2">
                <label >Eliminar Items</label><br>
                <button type="button" class="btn btn-danger" id="eliminarC" disabled>Elimniar</button>
              </div>
           </div>
          </div>
        </div>
       <div class="panel panel-default" id="mas"> 
        
       </div>
        
      <div class="modal-footer">
        <button  id="btnAdicionarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
      </div>
    </div>
  </div>

</div>
</div>

<form name="formularioModificar" role="form" id="formularioModificar" method="post" action="RestLinea/actualizar"
data-fv-excluded="disabled"
data-fv-icon-valid="glyphicon glyphicon-ok"
data-fv-icon-invalid="glyphicon glyphicon-remove"
data-fv-icon-validating="glyphicon glyphicon-refresh">
<div class="modal fade" id="modalModificar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog"role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Modificar Linea</h4>
      </div>
      <div class="modal-body">
        <input type="hidden" name="idlinea" id="idlinea" />
        <!-- Text input-->

        <div class="form-group">
         <label>Nombre</label> <input id="nomlinea1" name="nombre" type="text"
         placeholder="ingrese Linea" class="form-control input-md"
         data-fv-notempty="true">
       </div>
     </div>
     <div class="modal-footer">
      <button type="submit" id="btnModificarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
      <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
    </div>
  </div>
</div>

</div>
</form>
<div class="modal fade" id="modalEliminar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <form name="formularioEliminar" role="form" id="formularioEliminar" method="post" action="RestLinea/eliminar"
  data-fv-excluded="disabled"
  data-fv-icon-valid="glyphicon glyphicon-ok"
  data-fv-icon-invalid="glyphicon glyphicon-remove"
  data-fv-icon-validating="glyphicon glyphicon-refresh">
  <div class="modal-dialog " style="width: 40%" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Eliminar Linea</h4>
      </div>
      <div class="modal-body">
        <input type="hidden" id="idlinea2" name="idlinea" />  
        <div class="row">
         <div class="col-md-9"><h3>¿Esta seguro de Eliminar? <b id="tipoLabel"></b></h3></div>
       </div>   
     </div>
     <div class="modal-footer">
      <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
      <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
    </div>
  </div>
</div>
</form>
</div>

<div class="row">
  <div class="col-lg-12">
    <div class="panel panel-default">

      <div class="panel-body">
       <div class="dataTable_wrapper">
        <table id="example" class="w3-table-all w3-tiny w3-table-hoverable w3-card-4" style="width: 100% !important">
          <thead>
            <tr>
             <th>Nº Compra</th>
             <th>Fecha compra</th>
             <th>Nº embarque</th>
             <th>Nº importaci&#243;n</th>
             <th>Pais origen</th>
             <th>Total</th>
             <th ></th>
           </tr>
         </thead>
         <tbody >

         </tbody>
       </table>  
     </div>
   </div>
 </div>
</div>
</div> 
<script type="text/javascript">
  var conta=0;
  var contase="";
  $(document).ready(function() {
    conta=0;
    var btnGroup='';
    $('#example').dataTable( {
      "oLanguage": {
        "sUrl": "js/Spanish.lang"
      },
      responsive:true,
      "processing": true,
      "dom":"<'row w3-tiny'<'col-sm-8'<'#tableTitle'>><'col-sm-1'<'#tableHeader'>><'col-sm-3'f>><'row'<'col-sm-12'tr>><'row w3-tiny'<'col-sm-5'i><'col-sm-7'p>>",
      "serverSide": true,
      "ajax": {
       "type": "POST",
       "url": "RestComp/lista",
       "data": function ( d ) {
         d.estado = 1;
       }
     },
     "columns": [
     { "data": "num_compra" },
     { "data": "fecha_importacion" },
     { "data": "num_embarque" },
     { "data": "num_importacion" },
     { "data": "idpais" },
     { "data": "idcomp" },
     { "data": "idcomp" }
     ],
     "createdRow": function ( row, data, index ){
       if(data.estado==1){
         btnGroup='';
         btnGroup+='<button class="btn btn-xs btn-info detalle"  data-toggle="tooltip" data-placement="top" title="Detalle" data-id="'+data.idcomp+'"><i class="glyphicon glyphicon-th-list"></i> | detalle</button>';
         btnGroup+='<button class="btn btn-xs btn-primary modificar"  data-toggle="tooltip" data-placement="top" title="Modificar" data-id="'+data.idcomp+'"><i class="fa fa-edit"></i> | modificar</button>';
         btnGroup+='<button class="btn btn-xs btn-danger eliminar"  data-toggle="tooltip" data-placement="top" title="Eliminar" data-id="'+data.idcomp+'"><i class="glyphicon glyphicon-remove-sign"></i> | eliminar</button>';

         $('td', row).eq(6).html('<div class="btn-group">'+btnGroup+'</div>');
         $.post('RestPaises/obtener?id='+data.idpais, function(result){
           $('td', row).eq(4).html(result.data.nombre);
         })
       }
     },
     "drawCallback": function( settings ) {
     conta=0
      $('#tableTitle').html('<h6><b>Compras</b></h6>');
      $('#tableHeader').html('<button class="btn btn-xs btn-primary" id="btnAdicionar"><i class="fa fa-plus-circle"></i> | Nueva Compra</button>');
      $('#btnAdicionar').click(function(){
        
        //$('#formularioagregar').data('formValidation').resetForm();
        $('#formularioagregar')[0].reset();
        $('#modalAdicionar').modal('show');
        $.post('RestPaises/listar', function(result) {
           
            if(result.status){
                var cad="";
                for(var i=0;i<result.data.length;i++){
                cad=cad+'<option value="'+result.data[i].idpais+'">'+result.data[i].nombre+'</option>';
                }   
                 $('#pais1').html(cad);
                 $('#pais1').selectpicker();
                 $('#pais1').selectpicker('refresh');        
       
            }
             conta=0;
        }, 'json');
        
          
          $('#mas').empty() ;
          $('.tb').remove();
          
          $('#mas').html("");
          var contenido="";  
        $('#agregarC').click(function(){
          console.log("aqui"+conta)

         conta=conta+1;
          contenido=""
          

          contenido='<div id="conteni'+conta+'"><div class="form-group" ><div class="row" id="mmc"><form name="formularioIditem'+conta+'" role="form" id="formularioIditem'+conta+'"method="post" action="RestItem/obtenerdesdeC" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh"><div class="col-sm-4 justify-content-center" ><label>Marca</label><br><select class="form-control" selectpicker data-live-search="true" name="idmarc" id="marcm'+conta+'" onchange=(marca(this)) data-id="'+conta+'"></select></div><div class="col-sm-4 justify-content-center"><label >Modelo</label><br><select class="form-control" selectpicker data-live-search="true" name="idmod" id="modm'+conta+'" onchange=(modelo(this)) data-id="'+conta+'" ></select></div><div class="col-sm-4 justify-content-center" ><label >Color</label><br><select class="form-control " name="idcolor" id="colm'+conta+'" onchange=(color(this)) data-id="'+conta+'"></select></div></div></form><div class="row"><div class="col-lg-12"><div class="panel panel-default"><div class="panel-body"><div class="dataTable_wrapper"><table id="tablam'+conta+'" class=" tb w3-table-all w3-tiny w3-table-hoverable w3-card-4" style="width: 100% !important"><thead><tr><th>Nº Chasis</th><th>Nº Motor</th><th>Precio</th><th>Estado</th><th></th></tr></thead><tbody id="cuerpotablam'+conta+'"><tr id="fila'+conta+'"><form name="formularioAgreArt'+conta+'" role="form" id="formularioAgreArt'+conta+'"method="post" action="RestArt/guardar" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh"><td><input data-id="'+conta+'" id="chasism'+conta+'" name="num_chasis" type="text" placeholder="ingrese chasis" class="small form-control input-sd" onkeyup=(validarchasis(this)) data-id="'+conta+'" data-id2="'+conta+'" onblur=(validarEnTabla(this))></td><td><input data-id="'+conta+'" data-id2="'+conta+'"  id="motorm'+conta+'" name="num_motor" type="text" onblur=(validarEnTablaMotor(this)) placeholder="ingrese chasis" class="form-control input-sd"></td><td><input id="preciom'+conta+'" name="precio" type="text" placeholder="ingrese precio" class="form-control input-sd"></td><td><div><select class="form-control" id="estaitemm'+conta+'"  name="idestaitem" ><option value="0" disabled >Seleccione Estado</option><option value="1">Armada</option><option value="2">Semiarmada</option><option value="3">CKD</option></select></div></td> <td><button id="agre'+conta+'" class="btn btn-xs btn-info masI"  data-toggle="tooltip" data-placement="top" title="agregar" data-id="'+conta+'" data-id2="'+conta+'" data-id3="'+conta+'"  onclick=(agregarI(this))><i class="glyphicon glyphicon-plus"></i> </button><button class="btn btn-xs btn-danger eliminarI" id="eli'+conta+'" data-toggle="tooltip" data-placement="top" title="Eliminar" data-id="'+conta+'" data-id2="'+conta+'" data-id3="'+conta+'"(eliminarI(this))><i class="glyphicon glyphicon-remove-sign"></i></button></td></form></tr></tbody></table></div></div></div></div></div></div></div>'

           $('#mas').append(contenido); 
           $('#eliminarC').prop("disabled",false);
           listarporitem()
          
        });

        $('#eliminarC').click(function(){
          var con="#conteni"+conta;
          console.log(con)
          console.log($(con).length)
          if($(con).length>0){
            console.log('entra')
            $(con).remove();
          }
          
          conta--;
          if(parseInt(conta)==0){
            $('#eliminarC').prop("disabled",true);
          }
        })

      });

      $('.modificar').click(function(){ 
       $('#formularioModificar').data('formValidation').resetForm();
       $('#formularioModificar')[0].reset();
    $.post('RestLinea/obtener?id='+$(this).data('id'), function(result) {//$(this).data('id') es el atributo del boton data-id; q tiene el idpais en cada registro
      console.log('respuesta del servidor:',result)
      if(result.status){

       $('#modalModificar').modal('show');
       $('#formularioModificar').loadJSON(result.data);
       
     }
   }, 'json');
  });
      $('.eliminar').click(function(){ 
       $('#formularioEliminar').data('formValidation').resetForm();
       $('#formularioEliminar')[0].reset();
       $.post('RestLinea/obtener?id='+$(this).data('id'), function(result) {
         if(result.status){
          $('#modalEliminar').modal('show');
          $('#formularioEliminar').loadJSON(result.data);
          $('#tipoLabel').html(result.data.nombre);
        }
      }, 'json');
     });

      var cont=0;
      $('.detalle').click(function(){     
       $.post('RestComp/obtener?id='+$(this).data('id'), function(result) {
         if(result.status){
          $('#modalDetalle').modal('show');  
          $('#formularioDcompra').loadJSON(result.data);
          var tabl="";
          $.post('RestComp/dcompralista?id='+result.data.idcomp, function(result2) {
            if(result2.status){
              var tab
              for(var i=0;i<result2.data.length;i++){
                console.log(result2.data[i])
                tab=tab+'<tr><td>'+result2.data[i].articulo.item.modelo.marca.nombre+'</td><td>'+result2.data[i].articulo.item.modelo.nombre+'-'+result2.data[i].articulo.item.modelo.anho+'</td><td>'+result2.data[i].articulo.item.color.nombre+'</td><td>'+result2.data[i].articulo.num_chasis+'</td> <td>'+result2.data[i].articulo.num_motor+'</td><td>'+result2.data[i].precio+'</td></tr>';
              }
          //$('#cuerpotabla').val("");
          $('#cuerpotabla').html(tab);
          if(cont==0){ 
            $('#example2').dataTable( {
              "oLanguage": {
                "sUrl": "js/Spanish.lang"
              }
            })
            cont++;
          }
        }
      }, 'json')

        }
      }, 'json')


     });

      $('button[data-toggle="tooltip"]').tooltip({animated: 'fade',placement: 'bottom',});

    }
  } );





  $('.estado').click(function(){
    $('#example').dataTable().fnDraw('page');
  });

  $('#formulario,#formularioModificar,#formularioEliminar').formValidation(
    {locale: 'es_ES'}).on('success.form.fv', function(e) {
                          e.preventDefault();// para dejar la pantalla en la posicion que se encuentra 
                          var $form = $(e.target);

                          $.post($form.attr('action'), $form.serialize(), function(result) {
                            if(result.status){
                             $form.data('formValidation').resetForm();
                             $('#formulario')[0].reset();
                             $('#formularioModificar')[0].reset();
                             $('#formularioEliminar')[0].reset();
                             $('#example').dataTable().fnDraw('page');
                            //  mostrarMensaje('info','Se realizo con exito la Transaccion');

                          }
                          $('.modal').modal('hide');
                        }, 'json');
                        });
  });

  function listarporitem(){
    $.post('RestMarc/listarporitem', function(result) {
            if(result.status){
                var cad="<option value='0' disabled>Seleccione Marca</option>";
                for(var i=0;i<result.data.length;i++){
                cad=cad+'<option value="'+result.data[i].idmarc+'">'+result.data[i].nombre+'</option>';
                }   
                var a='#marcm'+conta;
                 $(a).html(cad);
                 $(a).val(0)
                 $(a).selectpicker();
                $(a).selectpicker('refresh');     
       
            }
        }, 'json');
  }
  function marca(ob){
          var posicion=$(ob).data('id');
          var idmarc=$(ob).val();
          console.log('entra marca')
          $.post('RestMod/listarporItemIdMarca?idmarc='+idmarc, function(result) {
            
            if(result.status){
                
                var cad="<option value='0' disabled>Seleccione Modelo</option>";
                for(var i=0;i<result.data.length;i++){
                cad=cad+'<option value="'+result.data[i].idmod+'">'+result.data[i].nombre+'-'+result.data[i].anho+'</option>';
                }   
                var a='#modm'+posicion;
                 $(a).html(cad);
                 $(a).val(0);
                 $(a).selectpicker();      
                 $(a).selectpicker('refresh');
       
            }
        }, 'json');
        }
         function modelo(ob){
          var posicion=$(ob).data('id');
          var idmod=$(ob).val();
          console.log('entra modelo')
          $.post('Restcol/listarporItemIdMod?idmod='+idmod, function(result) {
            
            if(result.status){
                var cad="";

                var cad="<option value='0' disabled >Seleccione Color</option>";
                for(var i=0;i<result.data.length;i++){
                cad=cad+'<option value="'+result.data[i].idcolor+'">'+result.data[i].nombre+'</option>';
                }   
                var a='#colm'+posicion;
                 $(a).html(cad);  
                 $(a).val(0)    
       
            }
        }, 'json');
        }

        function color(ob){
          var posicion=$(ob).data('id');
          var idmod=$(ob).val(); 
        }
        function agregarI(ob){
          var contad=$(ob).data('id');//POSICION
          var p2=$(ob).data('id2')+1;//POSICICON2
          var p3=$(ob).data('id3')//posicion actual
          var chasis="#chasism"+p3;
          var motor="#motorm"+p3;
          var precio="#preciom"+p3;
          var estadoitem="#estaitemm"+p3;
          var tabla="#cuerpotablam"+contad;
          var botonA='#agre'+p3
          var botonE='#eli'+p3
          console.log(p2)
          if($(chasis).val()!="" && $(motor).val()!="" && $(precio).val() != "" && $(estadoitem).val()!=null){
      
             var contenid='<tr id="fila'+contad+p2+'"><form name="formularioAgreArt'+contad+p2+'" role="form" id="formularioAgreArt'+contad+p2+'"method="post" action="RestArt/guardar" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh"><td><input data-id="'+contad+p2+'" data-id2="'+p2+'" onblur=(validarEnTabla(this)) id="chasism'+contad+p2+'"  name="num_chasis" type="text" onkeyup=(validarchasis(this)) placeholder="ingrese chasis" class="small form-control input-sd" data-id="'+contad+p2+'"></td><td><input data-id="'+contad+p2+'" id="motorm'+contad+p2+'" data-id2="'+p2+'"  name="num_motor" type="text" placeholder="ingrese chasis" onblur=(validarEnTablaMotor(this)) class="form-control input-sd"></td><td><input id="preciom'+contad+p2+'" name="precio" type="text" placeholder="ingrese precio" class="form-control input-sd"></td><td><div><select class="form-control" id="estaitemm'+contad+p2+'"  name="idestaitem" ><option value="0" disabled >Seleccione Estado</option><option value="1">Armada</option><option value="2">Semiarmada</option><option value="3">CKD</option></select></div></td> <td><button id="agre'+contad+p2+'" class="btn btn-xs btn-info masI"  data-toggle="tooltip" data-placement="top" title="agregar" data-id="'+contad+'" data-id2="'+p2+'" data-id3="'+contad+p2+'" onclick=(agregarI(this))><i class="glyphicon glyphicon-plus"></i> </button><button class="btn btn-xs btn-danger eliminarI" id="eli'+contad+p2+'" data-toggle="tooltip" data-placement="top" title="Eliminar" data-id="'+contad+'" data-id3="'+contad+p2+'" data-id2="'+p2+'" onclick=(eliminarI(this))><i class="glyphicon glyphicon-remove-sign"></i></button></td></form></tr>'

                $(tabla).append(contenid);
                $(botonA).prop("disabled",true);
                $(botonE).prop("disabled",true);
                console.log(botonA)
          }else {
           

            console.log('no entra')
          }
          
          
        }

        function eliminarI(ob){
          val=$(ob).data('id3')
          val2=$(ob).data('id2')
          val3=$(ob).data('id')
          elim='#fila'+val;
          if(val2>1){
            if(val2>2){
              val2=parseInt(val2);
              val2=val2-1;
              var botonA='#agre'+val3+val2;
              var botonB='#eli'+val3+val2;
              $(botonA).prop("disabled",false);
              $(botonB).prop("disabled",false);
            }else{
                  var botonA='#agre'+val3;
                  var botonB='#agre'+val3;
                  $(botonA).prop("disabled",false);
                  $(botonB).prop("disabled",false);
            }
          }
          $(elim).remove()
        }

        function validarEnTabla(ob){
          console.log('validarEnTabla()')
          var val=$(ob).val();
          var po=$(ob).data('id')//posicion actuAL
           var pofa=$(ob).data('id2')//posicion en aumento de -articulo
          
          var tem=parseInt(pofa)
          console.log(val+po+pofa+tem)
          var es=true;
          if(tem>1){
            for(i=1;i<=conta;i++){  
              for(j=(1+(i-1));j<=tem;j++){
                var val2='#chasism'+i;
                  if(j!=(1+(i-1))) val2='#chasism'+i+j;
              
                console.log('j es='+j)
                if(tem!=j && es && tem!=i){
                  console.log(val2)                
                  if(val==$(val2).val()){
                    console.log('emtra'+val2)
                    $(ob).css("border-color","red");
                    $(val2).css("border-color","red");
                    console.log('emtra'+val2)
                    es=false;
                  }else{
                    $(val2).css("border-color","#C6C6C6");
                    $(ob).css("border-color","#C6C6C6");
                    console.log('noentra')
                   $.post('RestArt/validarexistenciachasis?validar='+val, function(result) {
                      if(result.status){
                        if(es){
                          $(ob).css("border-color","red");
                          es=false;
                         }
                        }else{
                          if(es){
                            console.log('nnnn'+val2)
                            $(val2).css("border-color","#C6C6C6");
                            $(ob).css("border-color","#C6C6C6");
      
                            
                         }
                        }
                      }, 'json');
                  
                  }
                }
              }

            }
            

          }


        }
        function validarEnTablaMotor(ob){
          console.log('validarEnTabla()')
          var val=$(ob).val();
          var po=$(ob).data('id')//posicion actuAL
           var pofa=$(ob).data('id2')//posicion en aumento de -articulo
          
          var tem=parseInt(pofa)
          console.log(val+po+pofa+tem)
          var es=true;
          if(tem>1){
            console.log("if"+tem)
            for(i=1;i<=conta;i++){  
              for(j=(1+(i-1));j<=tem;j++){
                var val2='#motorm'+i;
                  if(j!=(1+(i-1)))val2='#motorm'+i+j;
                

                console.log('j es='+j)
                if(tem!=j && es && tem!=i ){
                  console.log(val2)                
                  if(val==$(val2).val()){
                    console.log('emtra'+val2)
                    $(ob).css("border-color","red");
                    $(val2).css("border-color","red");
                    console.log('emtra'+val2)
                    es=false;
                  }else{
                    $(val2).css("border-color","#C6C6C6");
                    $(ob).css("border-color","#C6C6C6");
                    console.log('noentra')
                   $.post('RestArt/validarexistenciamotor?validar='+val, function(result) {
                      if(result.status){
                        if(es){
                          $(ob).css("border-color","red");
                          es=false;
                         }
                        }else{
                          if(es){
                            console.log('nnnn'+val2)
                            $(val2).css("border-color","#C6C6C6");
                            $(ob).css("border-color","#C6C6C6");
      
                            
                         }
                        }
                      }, 'json');
                  
                  }
                }
              }

            }
            

          }


        }


        function validarchasis(ob){
        /*console.log('validarchasis()')
          var val=$(ob).val();
          var po=$(ob).data('id')//posicion actuAL
         var boton="#agre"+po;
          $.post('RestArt/validarexistenciachasis?validar='+val, function(result) {
            if(result.status){
               $(ob).css("border-color","red");
               
               $(boton).prop("disabled",true)
             }else{
              $(ob).css("border-color","#C6C6C6");
              $(val2).css("border-color","#C6C6C6");
              $(boton).prop("disabled",false)
             }
          }, 'json');
       */ 
      }
      function validarmotor(ob){
         /* var val=$(ob).val();
          var po=$(ob).data('id')
          var boton="#agre"+po;
          $.post('RestArt/validarexistenciamotor?validar='+val, function(result) {
            
            if(result.status){
             
               $(ob).css("border-color","red");
               
               $(boton).prop("disabled",true)
             }else{
              $(ob).css("border-color","#C6C6C6");
              
              $(boton).prop("disabled",false)
             }
          }, 'json');
*/
      }



 $('#formularioagregar').formValidation({locale: 'es_ES'}).on('success.form.fv', function(e) {
                          e.preventDefault();
                          var $form = $(e.target);
                          $.post($form.attr('action'), $form.serialize(), function(result) {
                            if(result.status){
                             //$form.data('formValidation').resetForm();
                             //$('#formularioagregar')[0].reset();
                            
                            console.log('entra')
                          }
                          //$('.modal').modal('hide');
                        }, 'json');
                        });

 
$('#btnAdicionarConfirmacion').click(function(){
    var ultimo=conta;
    var est=true;
    var gobal=0;
    
    if(ultimo==0){
      alert("Falta ingresar Datos")
      est=false
    }
    for(var i=ultimo;i>0;i--){
        var marcm="#marcm"+i;
        var modm="#modm"+i
        var colm="#colm"+i
        var estaitemm='#estaitemm'+i
        var preciom="#preciom"+i
        if($(marcm).length>0){
          var pro=$(marcm).val()
          if(pro==null){
            alert("falta llenar datos de marca")  
            est=false 
          }
        } 
        if($(modm).length>0){
          var pro=$(modm).val()
          if(pro==null){
            alert("falta llenar datos de modelo")   
            est=false
          }
          
        }
        if($(colm).length>0){
          var pro=$(colm).val()
          if(pro==null){
            alert("falta llenar datos de color")  
            est=false 
          }          
        }
        var j=1
        while ($(preciom).length>0) {
          var pro=$(preciom).val()
          if(pro==""){
            alert("falta llenar precio")   
            est=false
          }

          j++
          preciom="#preciom"+i
          preciom=preciom+j
          gobal=j;
          gobal--
        }
        j=1
        while($(estaitemm).length>0) {
          var pro=$(estaitemm).val()
          if(pro==""){
            alert("falta llenar precio")   
            est=false
          }
          j++
          estaitemm='#estaitemm'+i
          estaitemm=estaitemm+j
        }

    }
    if(est){
      idcomp=0;
      for(var i=ultimo;i>0;i--){
        var iditem=0;
        var formu="#formularioIditem"+i
        var formu2="#formularioAgreArt"+i
        var form=$(formu);
        var form2=$(formu2)
        var estaitemm='#estaitemm'+i
        var preciom="#preciom"+i
        var motorm='#motorm'+i
        var chasis='#chasism'+i
        console.log(formu)
        $.ajax({
            url : $(formu).attr('action'),
            type : "POST",
            data : $(formu).serialize()+'&'+$('#formularioagregar').serialize()+'&estad='+est+"&idcom="+idcomp
            ,
            success : function(resp) {
              iditem=resp.data.iditem
              idcomp=resp.data.idcomp
            }
          });
        for(var j=1;j<=gobal;j++){
         
          console.log('paso ' +formu2)
          $.ajax({
            url : $(formu2).attr('action'),
            type : "POST",
            data : {
              num_motor:$(motorm).val(),
              num_chasis:$(chasis).val(),
              precio:$(preciom).val(),
              idestaitem:$(estaitemm).val(),
              iditem:iditem
              }
            ,
            success : function(resp) {
            }

          });
          formu2="#formularioAgreArt"+i
          estaitemm='#estaitemm'+i
          preciom="#preciom"+i
          motorm='#motorm'+i
          chasis='#chasism'+i
          var r=j+1;
          formu2=formu2+r
          motorm=motorm+r
          chasis=chasis+r
          preciom=preciom+r
          estaitemm=estaitemm+r
          console.log(chasis)
        }
      }
    }


   })



</script>
